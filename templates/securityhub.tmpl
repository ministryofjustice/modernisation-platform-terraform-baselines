## This file is automatically generated based on what regions are enabled in an AWS account and what regions SecurityHub is available in.

%{ for account_region in account_regions ~}
%{ if contains(service_regions, account_region) ~}
# Enable SecurityHub in each available region
resource "aws_securityhub_account" "${account_region}" {
  provider = aws.${account_region}
}

# Enable Standard: AWS Foundational Security Best Practices
resource "aws_securityhub_standards_subscription" "${account_region}-aws-foundational" {
  provider      = aws.${account_region}
  depends_on    = [aws_securityhub_account.${account_region}]
  standards_arn = "arn:aws:securityhub:${account_region}::standards/aws-foundational-security-best-practices/v/1.0.0"
}

# Enable Standard: CIS AWS Foundations
resource "aws_securityhub_standards_subscription" "${account_region}-cis" {
  provider      = aws.${account_region}
  depends_on    = [aws_securityhub_account.${account_region}]
  standards_arn = "arn:aws:securityhub:::ruleset/cis-aws-foundations-benchmark/v/1.2.0"
}

# Enable Standard: PCI DSS v3.2.1
resource "aws_securityhub_standards_subscription" "${account_region}-pci" {
  provider      = aws.${account_region}
  depends_on    = [aws_securityhub_account.${account_region}]
  standards_arn = "arn:aws:securityhub:${account_region}::standards/pci-dss/v/3.2.1"
}

%{ else ~}
%{ endif ~}
%{ endfor ~}
